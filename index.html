<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>⚡ Hyper Electro Chat ⚡</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #eee; }
    #chat { max-width: 600px; margin: 20px auto; padding: 10px; border: 1px solid #444; }
    #messages { height: 300px; overflow-y: scroll; border: 1px solid #333; padding: 5px; margin-bottom: 10px; background:#222; }
    input, button { padding: 8px; margin: 5px; }
    .msg { margin: 4px 0; }
  </style>
</head>
<body>
  <div id="chat">
    <h2>⚡ Hyper Electro Chat ⚡</h2>
    <!-- Login -->
    <div id="login">
      <input type="password" id="password" placeholder="Enter password">
      <button id="loginBtn">Login</button>
      <p id="loginResult"></p>
    </div>
    <!-- Chat UI -->
    <div id="chatbox" style="display:none;">
      <div id="messages"></div>
      <input type="text" id="username" placeholder="Your name">
      <input type="text" id="message" placeholder="Type a message">
      <button id="sendBtn">Send</button>
    </div>
  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase setup
    const supabaseUrl = "https://rizpwdfhwtvzxnvpqxtx.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpenB3ZGZod3R2enhudnBxeHR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyOTUwMjYsImV4cCI6MjA4MDg3MTAyNn0.sXBFgN82rKQDSC16gXVTNpM5HY63P0EvX6A_RVJnV4I";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // Password + bad words
    const ENTRY_PASSWORD = "OopyPoopyPoop123";
    const BAD_WORDS = ["badword1", "badword2", "poop"];

    // Login
    document.getElementById("loginBtn").addEventListener("click", () => {
      const pw = document.getElementById("password").value;
      if (pw === ENTRY_PASSWORD) {
        document.getElementById("login").style.display = "none";
        document.getElementById("chatbox").style.display = "block";
        loadMessages();
        subscribeMessages();
      } else {
        document.getElementById("loginResult").textContent = "❌ Wrong password!";
      }
    });

    // Send message
    document.getElementById("sendBtn").addEventListener("click", async () => {
      const username = document.getElementById("username").value || "Anonymous";
      const content = document.getElementById("message").value;

      if (BAD_WORDS.some(w => content.toLowerCase().includes(w))) {
        alert("❌ Message contains banned words");
        return;
      }

      const { error } = await supabase.from("messages").insert([
        { user_id: null, content: username + ": " + content }
      ]);
      if (error) console.error(error);
      else document.getElementById("message").value = "";
    });

    // Load messages
    async function loadMessages() {
      const { data, error } = await supabase.from("messages").select("*").order("created_at", { ascending: true });
      if (error) { console.error(error); return; }
      const messagesDiv = document.getElementById("messages");
      messagesDiv.innerHTML = "";
      data.forEach(m => {
        const div = document.createElement("div");
        div.className = "msg";
        div.textContent = m.content;
        messagesDiv.appendChild(div);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // Subscribe realtime
    function subscribeMessages() {
      supabase.channel("chat-room")
        .on("postgres_changes", { event: "INSERT", schema: "public", table: "messages" }, payload => {
          const messagesDiv = document.getElementById("messages");
          const div = document.createElement("div");
          div.className = "msg";
          div.textContent = payload.new.content;
          messagesDiv.appendChild(div);
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        })
        .subscribe();
    }
  </script>
</body>
</html>

